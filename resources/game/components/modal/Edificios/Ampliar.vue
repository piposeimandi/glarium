<template>
    <div class="box">
        <div class="d-flex justify-content-center">
            <div v-if="!this.info.maximum">
                <div @click='ampliar' class="btn-apliar"><img :src="btnUpgrade"></div>
                <div>{{$t('building.upgrade')}}</div>
            </div>
            <div class="px-2">
                <div>{{$t('building.level')}}</div>
                <div class="number">{{level}}</div>
            </div>
            <div>
                <div><img :src="btnDowngrade"></div>
                <div>{{$t('building.demolition')}}</div>
            </div>
        </div>
        <div class="text-center mt-3">{{$t('building.upgradeText', { level: info.level || 0 })}}</div>
        <div class="my-2">
            <div class="d-inline-block" :title="$t('resources.wood')" v-if="info.wood!=0"><img :src="iconWood"> {{$money((info.wood || 0)*reducerWoodBuilding)}}</div>
            <div class="d-inline-block" :title="$t('resources.wine')" v-if="info.wine!=0"><img :src="iconWine"> {{$money((info.wine || 0)*reducerWineBuilding)}}</div>
            <div class="d-inline-block" :title="$t('resources.marble')" v-if="info.marble!=0"><img :src="iconMarble"> {{$money((info.marble || 0)*reducerMarbleBuilding)}}</div>
            <div class="d-inline-block" :title="$t('resources.glass')" v-if="info.glass!=0"><img :src="iconGlass"> {{$money((info.glass || 0)*reducerGlassBuilding)}}</div>
            <div class="d-inline-block" :title="$t('resources.sulfur')" v-if="info.sulfur!=0"><img :src="iconSulfur"> {{$money((info.sulfur || 0)*reducerSulfurBuilding)}}</div>
        </div>
        <div class="text-center" :title="$t('resources.time')" v-if="info.time!=0"><img :src="iconTime"> {{$sectotime(info.time || 0)}}</div>
    </div>
</template>

<script>
import axios from 'axios'
import $resources from 'Stores/resources'
import $notification from 'Stores/notification'
import $building from 'Stores/building';
import btnUpgrade from 'Img/icon/btn_upgrade.jpg';
import btnDowngrade from 'Img/icon/btn_downgrade.jpg';
import iconWood from 'Img/icon/icon_wood.png';
import iconWine from 'Img/icon/icon_wine.png';
import iconMarble from 'Img/icon/icon_marble.png';
import iconGlass from 'Img/icon/icon_glass.png';
import iconSulfur from 'Img/icon/icon_sulfur.png';
import iconTime from 'Img/icon/icon_time.png';

export default {
    name:'Ampliar',
    props:['info'],
    data() {
        return {
            btnUpgrade,
            btnDowngrade,
            iconWood,
            iconWine,
            iconMarble,
            iconGlass,
            iconSulfur,
            iconTime
        };
    },
    methods:{
        ampliar(){
            if (!this.info.city_building_id) {
                console.warn('city_building_id estÃ¡ indefinido');
                return;
            }
            axios.put('building/upgrade/'+this.info.city_building_id)
            .then(res =>{
                if(res.data!='ok'){
                    $notification.commit('show',{advisor:1,type:false,message:res.data});
                }else{
                    $building.dispatch('updateBuilding')
                    $notification.commit('show',{advisor:1,type:true});
                    $resources.commit('removeResources',{
                        wood:this.info.wood*this.reducerWoodBuilding,
                        wine:this.info.wine*this.reducerWineBuilding,
                        marble:this.info.marble*this.reducerMarbleBuilding,
                        glass:this.info.glass*this.reducerGlassBuilding,
                        sulfur:this.info.sulfur*this.reducerSulfurBuilding
                    });
                }
            })
            .catch(err =>{
                $notification.commit('show',{advisor:1,type:false,message:err});
            })
        }
    },
    computed:{
        level(){
            return this.info.maximum && this.info.level ? this.info.level : (this.info.level || 0) - 1;
        },
        reducerWoodBuilding(){
            return $building.getters.reducerBuilding(6) || 1;
        },
        reducerWineBuilding(){
            return $building.getters.reducerBuilding(9) || 1;
        },
        reducerMarbleBuilding(){
            return $building.getters.reducerBuilding(10) || 1;
        },
        reducerGlassBuilding(){
            return $building.getters.reducerBuilding(7) || 1;
        },
        reducerSulfurBuilding(){
            return $building.getters.reducerBuilding(8) || 1;
        }
    }
}
</script>

<style lang="scss" scoped>
    .box{
        font-size: 0.83rem;
        padding: 12px 20px!important;
    }
    .number{
        text-align: center;
        font-size: 1.8rem;
        font-weight: bold;
        line-height: 1.8rem;
    }
</style>
